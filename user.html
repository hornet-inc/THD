<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Power Dashboard</title>
  <link rel="stylesheet" href="css/user.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h1>‚ö°Smart Active Power Dashboard‚ö°</h1>
    <div id="status-indicator">Status: <span id="system-status">Connecting...</span></div>

    <!-- 7-Segment Style Displays -->
    <div class="segment-display-grid">
      <div class="segment-card"><label>Voltage</label><div class="segment" id="voltage">--</div><span>V</span></div>
      <div class="segment-card"><label>Current</label><div class="segment" id="current">--</div><span>A</span></div>
      <div class="segment-card"><label>Power</label><div class="segment" id="power">--</div><span>W</span></div>
      <div class="segment-card"><label>Frequency</label><div class="segment" id="frequency">--</div><span>Hz</span></div>
      <div class="segment-card"><label>PF</label><div class="segment" id="pf">--</div></div>
      <div class="segment-card"><label>THD</label><div class="segment" id="thd">--</div><span>%</span></div>
    </div>

    <!-- Time Series Graph -->
    <section class="graph-section">
      <h2>üìà Parameter Trends</h2>
      <select id="parameter-select" multiple>
        <option value="voltage">Voltage</option>
        <option value="current">Current</option>
        <option value="power">Power</option>
        <option value="frequency">Frequency</option>
        <option value="pf">Power Factor</option>
        <option value="thd">THD</option>
      </select>
      <canvas id="dataChart" height="150"></canvas>
    </section>

<!-- Tariff Section -->
<section class="tariff-section">
  <h2>üí∞ Tariff Monitor</h2>

  <!-- üî• Current Trends of Tariff üî• -->
  <div class="tariff-trends neon-red">
    <h3>‚ö° Current Trends of Tariff ‚ö°</h3>
    <div class="trend-grid">
      <div><strong>‚Çπ/Hour Rate:</strong> <span id="trend-energy-rate">--</span></div>
      <div><strong>Base Fixed Charge:</strong> <span id="trend-fixed">--</span></div>
      <div><strong>Harmonic Surcharge:</strong> <span id="trend-surcharge">--</span></div>
      <div><strong>Additional Cess:</strong> <span id="trend-cess">--</span></div>
    </div>
  </div>

  <!-- ‚ú® Tariff Controls -->
  <div class="tariff-controls">
    <button id="start-tariff">START</button>
    <button id="reset-tariff">RESET</button>
    <label>
      <input type="checkbox" id="toggle-fixed" />
      Include Fixed Charge
    </label>
  </div>

  <!-- üìä Tariff Data -->
  <div class="segment-display-grid tariff-display">
    <div class="segment-card">
      <label>Energy (Wh)</label>
      <div class="segment" id="energy-wh">0</div>
    </div>
    <div class="segment-card">
      <label>‚Çπ/Hour</label>
      <div class="segment" id="tariff-hour">0.00</div>
    </div>
    <div class="segment-card">
      <label>Uptime (min)</label>
      <div class="segment" id="tariff-uptime">0</div>
    </div>
    <div class="segment-card">
      <label>Total ‚Çπ</label>
      <div class="segment" id="tariff-total">0.00</div>
    </div>
  </div>

  <!-- üö® Harmonic Info -->
  <div class="harmonic-info hidden" id="harmonic-warning">
    <strong>‚ö†Ô∏è THD OVERSHOOT SURCHARGE ADDED</strong><br />
    <span>Harmonics Uptime: <span id="harmonic-uptime">0</span> min</span>
  </div>
</section>



    <!-- Notifications -->
    <section class="alert-section">
      <h2>üö® Custom Alerts</h2>
      <div class="alert-form">
        <label for="alert-param">Parameter:</label>
        <select id="alert-param">
          <option value="voltage">Voltage</option>
          <option value="current">Current</option>
          <option value="power">Power</option>
          <option value="pf">Power Factor</option>
          <option value="thd">THD</option>
        </select>
        <label for="alert-max">Max Value:</label>
        <input type="number" id="alert-max" placeholder="Enter max" />
        <label for="alert-warning">Early Warning (% before max):</label>
        <input type="number" id="alert-warning" value="80" />
        <div class="alert-buttons">
          <button id="set-alert">Set Notification</button>
          <button id="cancel-alert">Cancel</button>
        </div>
      </div>
      <div id="alert-status">Alert: <span>None</span></div>
    </section>

    <!-- Notification Modal -->
<div id="notification-modal" class="hidden">
  <div class="notification-overlay"></div>
  <div class="notification-box">
    <h2 id="notification-title">‚ö†Ô∏è Alert</h2>
    <p id="notification-message">Something important happened.</p>
    <button id="notification-close">Dismiss</button>
  </div>
</div>


    <!-- Data Logging -->
    <section class="log-section">
      <h2>üìÅ Data Logging</h2>
      <div class="log-controls">
        <button id="start-log">RECORD</button>
        <button id="stop-log">SAVE</button>
      </div>
      <p>Log Status: <span id="log-status">Idle</span></p>
    </section>
  </div>

  <!-- Push Notification Permission Prompt -->
  <script>
    if ("Notification" in window && Notification.permission !== "granted") {
      Notification.requestPermission();
    }
  </script>

  <script src="js/user.js"></script>
</body>
</html>
